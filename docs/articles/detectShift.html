<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>detectShift • actR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="detectShift">
<meta property="og:description" content="actR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">actR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/abruptShift_tests.html">abruptShift_tests</a>
    </li>
    <li>
      <a href="../articles/detectExcursion.html">detectExcursion</a>
    </li>
    <li>
      <a href="../articles/detectShift.html">detectShift</a>
    </li>
    <li>
      <a href="../articles/neotoma.html">neotoma</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="detectShift_files/header-attrs-2.14/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>detectShift</h1>
            
      
      
      <div class="hidden name"><code>detectShift.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">actR</span><span class="op">)</span></code></pre></div>
<div id="shift-detection-in-actr" class="section level2">
<h2 class="hasAnchor">
<a href="#shift-detection-in-actr" class="anchor"></a>Shift detection in actR</h2>
<p>This vignette shows how actR detects shift (and their statistical
significance) for 2 of our example datasets: the geob7926_2 sedimentary
record of Kim et al <a href="https://www.doi.org/10.1016/j.epsl.2012.05.018">2012</a> covering
the last deglaciation (roughly 28 to 9ka BP) and the Great Basin
tree-ring record of Salzer et al <a href="https://www.doi.org/10.1007/s00382-013-1911-9">2013</a> covering
the Common Era at annual resolution.</p>
<p>The following code does these things: * loads the data from the
provided LiPD file “geob7926_2” (available as a tibble for easier
load-in). * extracts the pre-existing age ensemble (generated using <a href="https://cran.r-project.org/web/packages/rbacon/index.html">Bacon</a>
within <a href="https://nickmckay.github.io/GeoChronR/">GeoChronR</a>)
and the akenone-reconstructed SST. * tests significance against 50
surrogate timeseries [need to clarify difference between n.ens and
null.hypothesis.n]. * specifies a minimum segment length of 3000y</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">msGeob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectShift.html">detectShift</a></span><span class="op">(</span><span class="va">geob7926_2</span>,
                    time.variable.name <span class="op">=</span> <span class="st">"ageEnsemble"</span>,
                    vals.variable.name <span class="op">=</span> <span class="st">"SST_from_uk37_ensemble"</span>,
                    method <span class="op">=</span> <span class="st">"PELT"</span>,
                    null.hypothesis.n <span class="op">=</span> <span class="fl">50</span>,
                    summary.bin.step <span class="op">=</span> <span class="fl">500</span>,
                    minimum.segment.length <span class="op">=</span> <span class="fl">8000</span>,
                    n.ens <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="co">#&gt; Selected SST_from_uk37_ensemble</span>
<span class="co">#&gt; timeUnits is at least partially absent in the input data</span>
<span class="co">#&gt; Testing null hypothesis with 50 simulations, each with 50 ensemble members. </span>
<span class="co">#&gt; This will probably take about 1 minutes</span></code></pre></div>
<p>This lines generates a textual summary of the output:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">msGeob</span><span class="op">)</span>
<span class="co">#&gt; GeoB7926_2.Kim.2012 - SST_from_uk37_ensemble: Shift in Mean results</span>
<span class="co">#&gt; Searched for Shift in Mean with a minimum segment length of 8000 years, summarizing the results over windows of 500 years.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Overall result: Detected 2 Shift in Mean event(s) that were significant at the alpha &lt; 0.05 level</span>
<span class="co">#&gt; # A tibble: 2 × 3</span>
<span class="co">#&gt;   time_start time_end empirical_pvalue</span>
<span class="co">#&gt;        &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt; 1     26727.   27227.                0</span>
<span class="co">#&gt; 2     17727.   18227.                0</span>
<span class="co">#&gt; Time uncertainty considered? TRUE Time ensemble supplied (n = 100)</span>
<span class="co">#&gt; Paleo uncertainty considered? TRUE Values ensemble supplied (n = 2500)</span>
<span class="co">#&gt; Error propagation ensemble members = 50</span>
<span class="co">#&gt; Null hypothesis testing ensemble members = 50 </span>
<span class="co">#&gt; Members simulated using isospectral method</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter choices:</span>
<span class="co">#&gt; cpt.fun = changepoint::cpt.mean</span>
<span class="co">#&gt; minimum.segment.length = 8000</span>
<span class="co">#&gt; method = PELT</span>
<span class="co">#&gt; penalty = MBIC</span>
<span class="co">#&gt; ncpts.max = Inf</span></code></pre></div>
<p>and this command plots it:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">geoBplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">msGeob</span><span class="op">)</span></code></pre></div>
<p><img src="detectShift_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Note that, as usual with actR, the plot is a <a href="https://ggplot2.tidyverse.org">ggplot2</a> object, which is
infinitely customizable (e.g. for a talk, a poster, a paper, etc).</p>
<p>Now we repeat the same steps over the Great Basin tree-ring record of
Salzer et al <a href="https://www.doi.org/10.1007/s00382-013-1911-9">2013</a>. We first
attempt to detect changes in the mean.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">msGb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectShift.html">detectShift</a></span><span class="op">(</span><span class="va">great_basin</span>,
                     time.variable.name <span class="op">=</span> <span class="st">"year"</span>,
                    vals.variable.name <span class="op">=</span> <span class="st">"trsgi"</span>,
                    null.hypothesis.n <span class="op">=</span> <span class="fl">50</span>,
                    summary.bin.step <span class="op">=</span> <span class="fl">1</span>,
                    minimum.segment.length <span class="op">=</span> <span class="fl">50</span>,
                    simulate.time.uncertainty <span class="op">=</span> <span class="cn">FALSE</span>,
                    method <span class="op">=</span> <span class="st">"AMOC"</span>,
                    cpt.fun <span class="op">=</span> <span class="fu">changepoint</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/changepoint/man/cpt.mean.html">cpt.mean</a></span>,
                    paleo.uncertainty <span class="op">=</span> <span class="fl">0.1</span>,
                    n.ens <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="co">#&gt; Selected trsgi</span>
<span class="co">#&gt; Testing null hypothesis with 50 simulations, each with 50 ensemble members. </span>
<span class="co">#&gt; This will probably take about 1 minutes</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gbmPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">msGb</span><span class="op">)</span></code></pre></div>
<p><img src="detectShift_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>As you can see, the method does not detect any on this dataset.
However, one might also want to detect shifts in variance. To do so, all
you have to do is specify <code>cpt.fun = changepoint::cpt.var</code>
(leveraging the <a href="https://cran.r-project.org/web/packages/changepoint/index.html">changepoint</a>
package).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vsGb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detectShift.html">detectShift</a></span><span class="op">(</span><span class="va">great_basin</span>,
                     time.variable.name <span class="op">=</span> <span class="st">"year"</span>,
                    vals.variable.name <span class="op">=</span> <span class="st">"trsgi"</span>,
                    null.hypothesis.n <span class="op">=</span> <span class="fl">50</span>,
                    summary.bin.step <span class="op">=</span> <span class="fl">10</span>,
                    minimum.segment.length <span class="op">=</span> <span class="fl">200</span>,
                    simulate.time.uncertainty <span class="op">=</span> <span class="cn">FALSE</span>,
                    paleo.uncertainty <span class="op">=</span> <span class="fl">0.1</span>,
                    method <span class="op">=</span> <span class="st">"PELT"</span>,
                    cpt.fun <span class="op">=</span> <span class="fu">changepoint</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/changepoint/man/cpt.var.html">cpt.var</a></span>,
                    surrogate.method <span class="op">=</span> <span class="st">"shuffle"</span>,
                    n.ens <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="co">#&gt; Selected trsgi</span>
<span class="co">#&gt; Testing null hypothesis with 50 simulations, each with 50 ensemble members. </span>
<span class="co">#&gt; This will probably take about 1 minutes</span></code></pre></div>
<p>Note also that actR offers 3 different methods to generate
surrogates, as detailed in the documentation. The default is
<em>isospectral</em>, which was used in the previous examples. To change
that to the rEDM “shuffle” method, just specify
<code>surrogate.method = "shuffle"</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gbvPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vsGb</span><span class="op">)</span></code></pre></div>
<p><img src="detectShift_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Now a change in variance is detected at the very end of the record.
To check its robustness, we should probably inquire more about the
sample depth of the dataset (number of tree cores used to make the
composite in each year), as well as the technique used for removing the
biological component of the signal. This is a reminder that no
technique, however nifty, is a substitute for knowing your data!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicholas McKay, Julien Emile-Geay.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

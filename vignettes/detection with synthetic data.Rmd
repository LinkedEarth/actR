---
title: "Synthetic Data in  meanShift and excursion"
author: "Dave Edge"
date: "2022-10-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
devtools::load_all()
```

### Build a synthetic time series with a shift in mean

The time series will have 100 time steps, with a shift in mean at time 20

The mean shift will have a magnitude of 0.5

```{r}
syntheticTransition <- make_transition(length = 100, amp=0.5, start = 20)
```

### Detect Shift

we will test the synthetic time series with `detectShift`

```{r}
msGb <- detectShift(syntheticTransition,
                     time.variable.name = "year",
                     null.hypothesis.n = 50,
                     summary.bin.step = 1,
                     minimum.segment.length = 50,
                     simulate.time.uncertainty = FALSE,
                     method = "AMOC",
                     cpt.fun = changepoint::cpt.mean,
                     paleo.uncertainty = 0.1,
                     n.ens = 50)
```


###Plot shift

Let's plot the results

```{r}

plot(msGb)

```

### Build a synthetic time series with an excursion

The time series will have 1000 time steps, an excursion amplitude of 1 starting at step 400 and ending at step 600

```{r}
syntheticExcursion <- make_excursion(length = 10000,
                                     amplitude = 1, 
                                     delta.amplitude = 0,
                                     start.time = 4000, 
                                     duration=200,
                                     sample.spacing.frac = 0.05)
```

### Detect Excursion

we will test the synthetic time series with `detectExcursion`

The `event.yr` is 600

```{r}
excOutNoUnc <- detectExcursion(syntheticExcursion,
                          event.yr = 4100,
                          event.window = 400,
                          ref.window = 400,
                          sig.num = 2,
                          exc.type = "positive",
                          n.ens = 50,
                          null.hypothesis.n = 50,
                          simulate.time.uncertainty = TRUE,
                          simulate.paleo.uncertainty = TRUE)
```


###Plot Ecursion

Let's plot the results

```{r}

plot(excOutNoUnc)

```

